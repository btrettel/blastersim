\chapter{Theory}\label{theory}

\section{Interior ballistics}\label{interior-ballistics}

\subsection{Control volume variables}
% TODO

% TODO: list all member variables
% TODO: based around control volume mass and energy as presumably this helps with conservation

\subsection{Notation}

% i, j = control volume numbers
% k = gas species
% y = mass fraction

\subsection{Conservation laws}\label{conservation-laws}
% TODO
% mass conservation
% energy conservation

\begin{equation}
    \dv{\dot{m}_{k,i}}{t} = \sum_j \left(y_{k,j} \dot{m}_{j \rightarrow i} - y_{k,i} \dot{m}_{i \rightarrow j}\right)\label{eq:mass conservation}
\end{equation}

\begin{equation}
    \dv{E_i}{t} = -p_i \, A_i \, \dot{x}_i + \sum_j \left(\dot{m}_{j \rightarrow i} h_j - \dot{m}_{i \rightarrow j} h_i\right)\label{eq:energy conservation}
\end{equation}

% TODO: note that definition of $E_i$ could include more than thermal energy and might in the future
\begin{equation}
    E_i = m_i \, u_i
\end{equation}

% TODO: where the pressure work term comes from, why its sign is negative; see moran_fundamentals_2008 p. 39

\subsection{Equations of state}\label{equations-of-state}
% TODO

\begin{equation}
    p_i = \frac{m_i \, R_i \, T_i}{A_i \, x_i}\label{eq:ideal gas eos}
\end{equation}

\subsection{Thermodynamic properties}\label{thermo}
% TODO

% TODO: R from \gamma
% TODO: c_v from R
% TODO: c_p from R
% TODO: mixture u and h

\begin{equation}
    u_{k,i}(T) = u_{0,k} + c_{\text{v},k} \, (T_i - T_{0,k})\label{eq:internal energy}
\end{equation}

\begin{equation}
    h_{k,i}(T) = h_{0,k} + c_{\text{p},k} \, (T_i - T_{0,k})\label{eq:enthalpy}
\end{equation}

\subsection{Connection flow model}\label{connection-flow-model}
% TODO

\citet[ch.~5]{beater_pneumatic_2007}

\subsection{Valve opening model}\label{valve-opening-model}
% TODO

\subsection{Projectile and plunger equations of motion}\label{equations-of-motion}
% TODO

\begin{align}
    \dv{x_i}{t}       &= \dot{x}_i \\
    \dv{\dot{x}_i}{t} &= \frac{A_i}{m_{\text{eff},i}} \left(p_i - p_{\text{mirror},i} - p_{\text{f},i}\right) - \frac{k_i}{m_{\text{eff},i}} \left(x_i + l_{\text{pre},i}\right)
\end{align}

The effective mass of the projectile/plunger factors in the spring mass.
The spring is not moving at a uniform velocity as one end is stationary, so it would be incorrect to add all the spring mass to the effective mass.
The effective mass equation used is
\begin{equation}
    m_{\text{eff},i} = m_{\text{p},i} + C_\text{ms} m_{\text{s},i}\label{eq:effective mass}
\end{equation}
where $C_\text{ms} = \tfrac{1}{3}$ as suggested by \citet{ruby_equivalent_2000} for a stiff spring.

\subsection{Projectile and plunger friction model}\label{friction}
% TODO

\subsection{Plunger impact}\label{plunger-impact}

At the moment, BlasterSim does not handle plunger impact with the end of the plunger tube, and will crash if that occurs.
Plunger impact will be handled in a future version of BlasterSim.

\section{Exterior ballistics}\label{exterior-ballistics}
% TODO

\section{Numerical methods}\label{numerical-methods}

\subsection{Time integration}\label{time-integration}
% TODO

~\cite[p.~1081]{kreyszig_advanced_1993}
~\cite{henon_numerical_1982}

\subsection{Automatic differentiation}\label{autodiff}
% TODO

~\cite{trettel_btrettelflt_2026}

%\subsection{Uncertainty quantification}\label{uncertainty-quantification}
% TODO
% putko_approach_2001

%\subsection{Optimization}\label{optimization}
% TODO
% luke_essentials_2013
% Constraints: deb_efficient_2000 (also discuss modification of this)

% TODO: Also discuss robust optimization
% putko_approach_2001
