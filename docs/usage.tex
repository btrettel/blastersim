\chapter{Usage}\label{usage}

\section{Introduction}\label{intro}

BlasterSim simulates pneumatic and spring compressed gas guns with a \href{https://en.wikipedia.org/wiki/Lumped-element_model}{lumped parameter} model.

With BlasterSim, you simulate a foam dart blaster or any other compressed gas gun before building.
BlasterSim can also help answer hypothetical questions about an existing build, like whether performance will benefit from a particular change.
Optimal barrel length can be accurately calculated, avoiding inaccurate rules-of-thumb and tedious experiments with varying lengths of barrel.

This guide starts with the usage (\secref{usage}) and theory (\secref{theory}) of BlasterSim.
Later the guide discusses comparisons of BlasterSim against experimental measurements (\secref{validation}), details of how BlasterSim is tested otherwise (\secref{verification}), and notes on developing and contributing to BlasterSim (\secref{dev}).

BlasterSim is under development and not yet feature-complete.

\section{Installation}\label{installation}

BlasterSim has no dependencies.
BlasterSim is written in Fortran 2018 and will run on any computer a modern Fortran compiler allows.

Obtain the latest BlasterSim binary from \url{http://trettel.us/blastersim/releases/}.
For Linux, this is blastersim-\gittag-linux-x86-64.tgz. % chktex 8
For Windows, this is blastersim-\gittag-windows-x86-64.zip. % chktex 8
For macOS, this is blastersim-\gittag-mac-x86-64.tgz. % chktex 8

The \texttt{blastersim} executable on Linux/macOS and the \texttt{blastersim.exe} executable on Windows can either be placed in the directory you want to run BlasterSim from or placed on your \texttt{PATH}.

See \secref{compiling} for instruction on how to compile BlasterSim from the source tarball or clone of the Git repository.

\section{Running BlasterSim}\label{running}

With BlasterSim placed on your \texttt{PATH}, you can run BlasterSim by typing \texttt{blastersim} in your terminal.
With BlasterSim placed in your current directory, you can run BlasterSim by typing \texttt{./blastersim} on Linux or \texttt{blastersim} on Windows.

The first command line argument is the input file.
For example, to run BlasterSim on input.nml, type \texttt{blastersim input.nml}.

If BlasterSim is run without an input file by running the \texttt{blastersim} by itself, BlasterSim will print a message containing information about how to run BlasterSim, the BlasterSim version, and debugging information:
\lstinputlisting[breaklines=true]{blastersim-out-1.txt}

If BlasterSim is on your \texttt{PATH}, you can run BlasterSim with an input file like \texttt{blastersim springer-example.nml} to simulate the blaster described in the input file.
If BlasterSim is placed in your current directory, you can run BlasterSim with an input file like \texttt{./blastersim springer-example.nml} on Linux or \texttt{blastersim springer-example.nml} on Windows.
Using the example input file in \secref{springer-example} returns the following:
\lstinputlisting[breaklines=true]{blastersim-out-2.txt}

\section{Time trace output to CSV file}\label{csv}

After BlasterSim completes, a CSV spreadsheet with detailed data the simulation is written.
This spreadsheet can be opened in a spreadsheet program like Excel or any other program that supports CSV spreadsheets.
The name of the spreadsheet is determined by file name of the input file.
The file extension of the input file is removed and the file extension \texttt{csv} is used instead in the CSV output.
For example, in \secref{springer-example} the file name is springer-example.nml, so the spreadsheet is written to springer-example.csv.

The CSV file contains the following columns:
\begin{itemize}
\item \texttt{t} ($t$): Simulation time.
Floating-point number.
Units of ms.
\item \texttt{m\_total} ($m_\text{total}$): Total mass in the simulation.
Floating-point number.
Units of mg.
This should remain approximately constant and is present for debugging purposes.
\item \texttt{e\_total} ($e_\text{total}$): Total energy in the simulation.
Floating-point number.
Units of J.
This should remain approximately constant and is present for debugging purposes.
\item For each control volume $i$ (for a springer this would be the plunger tube, barrel, atmosphere for the plunger tube, and atmosphere for the barrel):
\begin{itemize}
    \item \texttt{x} ($x_i$): Position of the projectile/plunger.
    Floating-point number.
    Units of m.
    Not present for constant pressure control volumes like atmospheres.
    \item \texttt{x\_dot} ($\dot{x}_i$): Velocity of the projectile/plunger.
    Floating-point number.
    Units of m/s.
    Not present for constant pressure control volumes like atmospheres.
    \item \texttt{m} ($m_{i,k}$): Mass of gas $k$.
    Floating-point number.
    Units of mg.
    For constant pressure control volumes (atmospheres), this starts out at zero.
    This can be used to track leaks to the atmosphere.
    \item \texttt{e} ($e_i$): Energy of gas.
    Floating-point number.
    Units of J.
    For constant pressure control volumes (atmospheres), this starts out at zero.
    BlasterSim does not distinguish between work done on a control volume and leaks at the moment, so this being non-zero does not necessarily indicate anything about leaks.
    \item \texttt{p} ($p_i$): Pressure of gas.
    Floating-point number.
    Units of kPa.
    \item \texttt{temp} ($T_i$): Temperature of gas.
    Floating-point number.
    Units of K.
    \item \texttt{rho} ($\rho_i$): Mass density of gas.
    Floating-point number.
    Units of kg/m$^3$.
    Not present for constant pressure control volumes like atmospheres.
    \item \texttt{e\_f} ($e_{\text{f},i}$): Energy lost due to friction on the projectile/plunger.
    Floating-point number.
    Units of J.
    Not present for one side of a projectile/plunger control volume to avoid double counting.
    % TODO: Add definition of this term.
    \item \texttt{e\_s} ($e_{\text{s},i}$): Spring potential energy.
    Floating-point number.
    Units of J.
    Not present for one side of a projectile/plunger control volume to avoid double counting.
    % TODO: Add definition of this term.
    \item \texttt{e\_p} ($e_{\text{p},i}$): Projectile/plunger kinetic energy.
    Floating-point number.
    Units of J.
    Not present for one side of a projectile/plunger control volume to avoid double counting.
    For control volumes with springs ($m_\text{spring} \ne 0$~kg), the added mass from the spring is factored in as well.
    See~\eqref{effective mass} for how the spring mass factors in.
    % TODO: Add definition of this term
\end{itemize}
\item \texttt{rc}: Return code of \texttt{run} subroutine.
Integer.
A value of -1 means that BlasterSim will continue to the next time step.
A value of 0 means that BlasterSim completed the simulation successfully.
Values above 0 indicate an error occurred and are discussed in \secref{run-time-checks}.
\end{itemize}

\section{BlasterSim inputs in general}\label{inputs-general}

BlasterSim uses Fortran namelist format input files.
Namelist files are broken into groups and variables.
A group starts with the \texttt{\&} symbol, then the name of the group, and contains one or more variables which themselves are the actual input data.
A group ends with the \texttt{/} symbol.
For example, in the example namelist input file below, see that \texttt{group1} group contains the variables \texttt{a}, \texttt{b}, and \texttt{c}.
\texttt{a} is an integer, \texttt{b} is a floating point number (decimal number), and \texttt{c} is a string (which must be quoted).
A namelist file can contain multiple groups.
The example below has two groups, \texttt{group1} and \texttt{group2}.
Comments can be added with the \texttt{!} symbol.
Comments can take up an entire line as in the \texttt{group1} namelist below, or be placed at the end of a line as in the \texttt{group2} namelist below.

\begin{lstlisting}
&group1
a = 0
b = -1.01
c = "string1"
! comment
/

&group2
x = 1
y = 2.05 ! comment
z = "string2"
/
\end{lstlisting}

For more details of the namelist format, refer to the Intel Fortran Compiler documentation~\cite{noauthor_namelist_2025}.

BlasterSim uses metric units in its input files and internally.
Support for other unit systems is not planned due to the complexity of supporting multiple unit systems.
Scientific notation can be used to appropriately scale inputs.
For example, instead of 13 mm being written as \texttt{0.013}, the user can write \texttt{13.0e-3}.
When possible, I try to pick metric units that are convenient for each variable so that scaling is unnecessary.
This is not possible for lengths as BlasterSim is intended to work for a range of gas gun systems, from small pellet guns all the way through potato cannons.
Given the wide range of scales, for lengths the unit of m was selected, and the \texttt{e} notation previously mentioned can be used so that the user can select the appropriate scale.

\section{Pneumatic mode}\label{pneumatic}
% TODO

\subsection{\texttt{pneumatic} namelist group variables}\label{pneumatic-namelist}

The following variables are in the pneumatic namelist group.
If there is a corresponding typeset variable, the notation for that variable is also listed.

\input{geninput_pneumatic.tex}

\subsection{Example pneumatic input file}\label{pneumatic-example}
% TODO: Go through file and explain what it means.

\lstinputlisting{pneumatic-example.nml}

\section{Springer mode}\label{springer}
% TODO

As shown in \figref{springer time zero}, BlasterSim geometrically models the plunger tube and barrel are treated as cylindrical.
However, BlasterSim does not assume a sudden contraction exists between the plunger tube and barrel as shown by the figure.
That part of the figure is for illustration only.
The connection between the plunger tube and barrel can take any form.

\input{springer-figures.tex}

\subsection{\texttt{springer} namelist group variables}\label{springer-namelist}

The following variables are in the springer namelist group.
If there is a corresponding typeset variable, the notation for that variable is also listed.

\input{geninput_springer.tex}

\subsection{Example springer input file}\label{springer-example}
% TODO: Go through file and explain what it means.

\lstinputlisting{springer-example.nml}
